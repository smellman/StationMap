<html>
  <head>
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="https://rmap.ekispert.jp/production/rosen.css" />
    <script src="https://rmap.ekispert.jp/production/rosen.js"></script>
    <style>
    body {
      margin: 0;
    }
    #map {
      width: 100%;
      height: 100%;
    }
    </style>
  </head>
  <div id="map"></div>
  <script>
  var rosen

  function init(api_key) {
    // 1: window.postMessageをReactNativeのものからオリジナルの元に戻す
    window.postMessageReactNative = window.postMessage
    window.postMessage = window.originalPostMessage
    rosen = new Rosen("map", {
      apiKey: api_key,
    })

    // 2: selectStationイベントを有効にする
    rosen.on('selectStation', function(data){
      // 3: タップした場所に一つ以上の駅があれば最初の一つを利用する
      if (data.stations.length > 0) {
        var station = data.stations[0]
        var ret = {
          "code": station.code,
          "name": station.name,
        }
        // 4: 駅すぱあと路線図にタップした駅のマーカーをセットしておく
        rosen.setStationMarker(station.code)
        var ret_string = JSON.stringify(ret)
        // 5: React Native側のwindow.postMessageの実装を使ってクライアントに文字列としてデータを渡す
        window.postMessageReactNative(ret_string)
      }
    })
  }

  document.addEventListener('message', (event) => {
    if (event && event.data) {
      try {
        data = JSON.parse(event.data)
        if (data.type == "init_map") {
          init(data.api_key)
        }
      } catch (e) {
        console.log(e)
      }
    }
  })
  </script>
</html>
